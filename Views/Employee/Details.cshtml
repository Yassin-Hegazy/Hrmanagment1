@model HRMANGMANGMENT.Models.Employee
@using System.Security.Claims

@{
    ViewData["Title"] = "Employee Details";
}

<div class="container mt-4 animate-fade-in">
    <!-- Page Header -->
    <div class="page-header stagger-animation">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h2><i class="bi bi-person-badge-fill"></i> Employee Profile</h2>
                <p class="mb-0 opacity-75">Detailed employee information</p>
            </div>
            <div class="col-md-6 text-end">
                @if (User.IsInRole("SuperAdmin") || User.IsInRole("Super Admin"))
                {
                    <a asp-action="ManageRoles" asp-route-id="@Model.EmployeeId" class="btn btn-danger hover-lift">
                        <i class="bi bi-shield-lock-fill"></i> Manage Roles
                    </a>
                }
                @if (User.IsInRole("HRAdmin") || User.IsInRole("HR Admin"))
                {
                    <a asp-action="ManageAttributes" asp-route-id="@Model.EmployeeId" class="btn btn-primary hover-lift">
                        <i class="bi bi-sliders"></i> Manage Attributes
                    </a>
                }
                
                @* Edit Profile only for own profile or HRAdmin *@
                @if (User.IsInRole("HRAdmin") || User.IsInRole("HR Admin") || (User.FindFirst(ClaimTypes.NameIdentifier)?.Value == Model.EmployeeId.ToString()))
                {
                    @if (!User.IsInRole("SuperAdmin") || (User.FindFirst(ClaimTypes.NameIdentifier)?.Value == Model.EmployeeId.ToString()))
                    {
                        <a asp-action="Edit" asp-route-id="@Model.EmployeeId" class="btn btn-warning hover-lift">
                            <i class="bi bi-pencil-fill"></i> Edit Profile
                        </a>
                    }
                }
                <a asp-action="Index" class="btn btn-secondary hover-lift">
                    <i class="bi bi-arrow-left"></i> Back to List
                </a>
            </div>
        </div>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show animate-slide-right" role="alert">
            <i class="bi bi-check-circle-fill"></i> @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <div class="row stagger-animation">
        <!-- Personal Information -->
        <div class="col-md-6 mb-4">
            <div class="card glass-card hover-lift h-100 animate-slide-left">
                <div class="card-header card-gradient-primary">
                    <h5 class="mb-0"><i class="bi bi-person-fill"></i> Personal Information</h5>
                </div>
                <div class="card-body">
                    <div class="text-center mb-4">
                        <div class="profile-avatar">
                            @if (!string.IsNullOrEmpty(Model.ProfileImage))
                            {
                                <img src="~/uploads/profiles/@Model.ProfileImage" alt="@Model.FullName" 
                                     class="img-thumbnail" 
                                     style="width: 200px; height: 200px; border-radius: 50%; object-fit: cover;" />
                            }
                            else
                            {
                                <i class="bi bi-person-circle" style="font-size: 8rem; color: #667eea;"></i>
                            }
                        </div>
                        <h4 class="mt-3 gradient-text">@Model.FullName</h4>
                        <p class="text-muted">Employee ID: <strong>#@Model.EmployeeId</strong></p>
                        @if (!string.IsNullOrEmpty(Model.RoleName))
                        {
                            <span class="badge bg-warning fs-6"><i class="bi bi-shield-check"></i> @Model.RoleName</span>
                        }
                    </div>
                    
                    <hr />
                    
                    <dl class="row mb-0">
                        <dt class="col-sm-5"><i class="bi bi-person text-primary"></i> First Name:</dt>
                        <dd class="col-sm-7">@Model.FirstName</dd>

                        <dt class="col-sm-5"><i class="bi bi-person text-primary"></i> Last Name:</dt>
                        <dd class="col-sm-7">@Model.LastName</dd>

                        <dt class="col-sm-5"><i class="bi bi-credit-card text-primary"></i> National ID:</dt>
                        <dd class="col-sm-7">@(Model.NationalId ?? "Not provided")</dd>

                        <dt class="col-sm-5"><i class="bi bi-calendar text-success"></i> Date of Birth:</dt>
                        <dd class="col-sm-7">@(Model.DateOfBirth?.ToString("MMMM dd, yyyy") ?? "Not provided")</dd>

                        <dt class="col-sm-5"><i class="bi bi-globe text-info"></i> Country of Birth:</dt>
                        <dd class="col-sm-7">@(Model.CountryOfBirth ?? "Not provided")</dd>
                    </dl>
                </div>
            </div>
        </div>

        <!-- Contact Information -->
        <div class="col-md-6 mb-4">
            <div class="card glass-card hover-lift h-100 animate-slide-right">
                <div class="card-header card-gradient-info">
                    <h5 class="mb-0"><i class="bi bi-telephone-fill"></i> Contact Information</h5>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-4"><i class="bi bi-envelope-fill text-primary"></i> Email:</dt>
                        <dd class="col-sm-8">
                            @if (!string.IsNullOrEmpty(Model.Email))
                            {
                                <a href="mailto:@Model.Email" class="text-decoration-none">@Model.Email</a>
                            }
                            else
                            {
                                <span class="text-muted">Not provided</span>
                            }
                        </dd>

                        <dt class="col-sm-4"><i class="bi bi-phone-fill text-success"></i> Phone:</dt>
                        <dd class="col-sm-8">@(Model.Phone ?? "Not provided")</dd>

                        <dt class="col-sm-4"><i class="bi bi-geo-alt-fill text-danger"></i> Address:</dt>
                        <dd class="col-sm-8">@(Model.Address ?? "Not provided")</dd>
                    </dl>

                    <hr />

                    <h6 class="text-warning"><i class="bi bi-exclamation-triangle-fill"></i> Emergency Contact</h6>
                    <dl class="row mb-0">
                        <dt class="col-sm-4">Name:</dt>
                        <dd class="col-sm-8">@(Model.EmergencyContactName ?? "Not provided")</dd>

                        <dt class="col-sm-4">Phone:</dt>
                        <dd class="col-sm-8">@(Model.EmergencyContactPhone ?? "Not provided")</dd>

                        <dt class="col-sm-4">Relationship:</dt>
                        <dd class="col-sm-8">@(Model.Relationship ?? "Not provided")</dd>
                    </dl>
                </div>
            </div>
        </div>

        <!-- Employment Information -->
        <div class="col-md-6 mb-4">
            <div class="card glass-card hover-lift h-100 animate-scale">
                <div class="card-header card-gradient-success">
                    <h5 class="mb-0"><i class="bi bi-briefcase-fill"></i> Employment Information</h5>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-5"><i class="bi bi-building text-info"></i> Department:</dt>
                        <dd class="col-sm-7">
                            <span class="badge bg-info">@(Model.DepartmentName ?? "Not Assigned")</span>
                        </dd>

                        <dt class="col-sm-5"><i class="bi bi-briefcase text-primary"></i> Position:</dt>
                        <dd class="col-sm-7">
                            <span class="badge bg-primary">@(Model.PositionTitle ?? "Not Assigned")</span>
                        </dd>

                        <dt class="col-sm-5"><i class="bi bi-person-badge text-warning"></i> Manager:</dt>
                        <dd class="col-sm-7">@(Model.ManagerName ?? "None")</dd>

                        <dt class="col-sm-5"><i class="bi bi-calendar-check text-success"></i> Hire Date:</dt>
                        <dd class="col-sm-7">@(Model.HireDate?.ToString("MMMM dd, yyyy") ?? "Not provided")</dd>

                        <dt class="col-sm-5"><i class="bi bi-activity"></i> Status:</dt>
                        <dd class="col-sm-7">
                            @if (Model.IsActive)
                            {
                                <span class="badge bg-success">
                                    <i class="bi bi-check-circle-fill"></i> Active
                                </span>
                            }
                            else
                            {
                                <span class="badge bg-danger">
                                    <i class="bi bi-x-circle-fill"></i> Inactive
                                </span>
                            }
                        </dd>

                        <dt class="col-sm-5">Employment Status:</dt>
                        <dd class="col-sm-7">
                            <span class="badge bg-secondary">@(Model.EmploymentStatus ?? "Unknown")</span>
                        </dd>

                        <dt class="col-sm-5">Account Status:</dt>
                        <dd class="col-sm-7">
                            <span class="badge bg-secondary">@(Model.AccountStatus ?? "Unknown")</span>
                        </dd>

                        <dt class="col-sm-5">Employment Progress:</dt>
                        <dd class="col-sm-7">@(Model.EmploymentProgress ?? "Not set")</dd>
                    </dl>
                </div>
            </div>
        </div>

        <!-- Statistics Card -->
        <div class="col-md-6 mb-4">
            <div class="card glass-card hover-lift h-100 animate-scale">
                <div class="card-header card-gradient-warning">
                    <h5 class="mb-0"><i class="bi bi-graph-up"></i> Profile Statistics</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-6 mb-3">
                            <div class="stat-box">
                                <i class="bi bi-calendar3 text-primary" style="font-size: 2rem;"></i>
                                <h3 class="mt-2 gradient-text">
                                    @if (Model.HireDate.HasValue)
                                    {
                                        @((DateTime.Now - Model.HireDate.Value).Days / 365)
                                    }
                                    else
                                    {
                                        <text>0</text>
                                    }
                                </h3>
                                <p class="text-muted mb-0">Years of Service</p>
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="stat-box">
                                <i class="bi bi-check-circle text-success" style="font-size: 2rem;"></i>
                                <h3 class="mt-2 gradient-text">@Model.ProfileCompletion%</h3>
                                <p class="text-muted mb-0">Profile Complete</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="progress" style="height: 25px;">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" 
                             role="progressbar" 
                             style="width: @Model.ProfileCompletion%; background: var(--success-gradient);" 
                             aria-valuenow="@Model.ProfileCompletion" 
                             aria-valuemin="0" 
                             aria-valuemax="100">
                            @Model.ProfileCompletion% Complete
                        </div>
                    </div>

                    <hr />
                    
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="stat-box">
                                <i class="bi bi-clock text-info" style="font-size: 1.5rem;"></i>
                                <p class="mb-0 mt-2"><small class="text-muted">Last Login</small></p>
                                <strong>@(Model.LastLogin?.ToString("MMM dd, yyyy") ?? "Never")</strong>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-box">
                                <i class="bi bi-lock text-secondary" style="font-size: 1.5rem;"></i>
                                <p class="mb-0 mt-2"><small class="text-muted">Account</small></p>
                                <strong>@(Model.IsLocked ? "Locked" : "Active")</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Biography Section - Always visible -->
    <div class="card glass-card hover-lift animate-fade-in mb-4">
        <div class="card-header bg-gradient-to-r from-purple-500 to-pink-500" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            <h5 class="mb-0"><i class="bi bi-file-text-fill"></i> Biography / About Me</h5>
        </div>
        <div class="card-body">
            @if (!string.IsNullOrWhiteSpace(Model.Biography))
            {
                <p class="mb-0" style="line-height: 1.8; white-space: pre-wrap;">@Model.Biography</p>
            }
            else
            {
                <p class="text-muted mb-0 fst-italic">
                    <i class="bi bi-info-circle"></i> No biography has been added yet. 
                    <a asp-action="Edit" asp-route-id="@Model.EmployeeId">Click here to add one.</a>
                </p>
            }
        </div>
    </div>

    <!-- Additional Details (Admin-only info) -->
    @if (User.IsInRole("SuperAdmin") || User.IsInRole("Super Admin") || User.IsInRole("HRAdmin") || User.IsInRole("HR Admin"))
    {
        <div class="card glass-card hover-lift animate-fade-in">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0"><i class="bi bi-gear-fill"></i> System Information (Admin Only)</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <dl class="row mb-0">
                            <dt class="col-sm-6">Department ID:</dt>
                            <dd class="col-sm-6"><code>@Model.DepartmentId</code></dd>
                            
                            <dt class="col-sm-6">Position ID:</dt>
                            <dd class="col-sm-6"><code>@Model.PositionId</code></dd>
                            
                            <dt class="col-sm-6">Manager ID:</dt>
                            <dd class="col-sm-6"><code>@Model.ManagerId</code></dd>
                        </dl>
                    </div>
                    <div class="col-md-4">
                        <dl class="row mb-0">
                            <dt class="col-sm-6">Contract ID:</dt>
                            <dd class="col-sm-6"><code>@Model.ContractId</code></dd>
                            
                            <dt class="col-sm-6">Pay Grade:</dt>
                            <dd class="col-sm-6"><code>@Model.PayGrade</code></dd>
                            
                            <dt class="col-sm-6">Salary Type ID:</dt>
                            <dd class="col-sm-6"><code>@Model.SalaryTypeId</code></dd>
                        </dl>
                    </div>
                    <div class="col-md-4">
                        <dl class="row mb-0">
                            <dt class="col-sm-6">Tax Form ID:</dt>
                            <dd class="col-sm-6"><code>@Model.TaxFormId</code></dd>
                            
                            <dt class="col-sm-6">Role Name:</dt>
                            <dd class="col-sm-6"><code>@Model.RoleName</code></dd>
                            
                            <dt class="col-sm-6">Is Locked:</dt>
                            <dd class="col-sm-6"><code>@Model.IsLocked</code></dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

<style>
    .profile-avatar {
        animation: float 3s ease-in-out infinite;
    }
    
    .stat-box {
        padding: 1rem;
        border-radius: 12px;
        transition: all 0.3s ease;
    }
    
    .stat-box:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }
</style>
